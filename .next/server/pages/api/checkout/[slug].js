"use strict";(()=>{var e={};e.id=441,e.ids=[441],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},327:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>d,default:()=>c,routeModule:()=>p});var o=n(1802),s=n(7153),a=n(6249),i=n(7931),u=e([i]);i=(u.then?(await u)():u)[0];let c=(0,a.l)(i,"default"),d=(0,a.l)(i,"config"),p=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/checkout/[slug]",pathname:"/api/checkout/[slug]",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},9115:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{GG:()=>i,S5:()=>a});var o=n(6090),s=e([o]);o=(s.then?(await s)():s)[0];let a=(process.env.STRIPE_SECRET_KEY||"").startsWith("sk_test_"),i=new o.default(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"});r()}catch(e){r(e)}})},7931:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>a});var o=n(9115),s=e([o]);async function a(e,t){let n="GET"===e.method&&e.query.debug;if("POST"!==e.method&&!n)return t.status(405).json({error:"Method Not Allowed"});let r=process.env.DOMAIN||`${e.headers["x-forwarded-proto"]||"https"}://${e.headers.host}`,s=String(e.query.slug||""),a={toolkit:{env:["FM_TOOLKIT_PRICE_ID","PRICE_TOOLKIT"],mode:"payment"},founders:{env:"PRICE_FOUNDERS_ONLY",mode:"payment"},"support-monthly":{env:"PRICE_SUPPORT_MONTHLY",mode:"subscription"},"support-nyop":{env:"PRICE_SUPPORT_NYOP",mode:"payment"},"common-mistakes":{env:"PRICE_COMMON_MISTAKES",mode:"payment"},"basic-motion":{env:"PRICE_BASIC_MOTION",mode:"payment"},"case-timeline":{env:"PRICE_CASE_TIMELINE",mode:"payment"},"common-response":{env:"PRICE_COMMON_RESPONSE",mode:"payment"},"cross-exam":{env:"PRICE_CROSS_EXAM",mode:"payment"},"evidence-log":{env:"PRICE_EVIDENCE_LOG",mode:"payment"},"find-rules":{env:"PRICE_FIND_RULES",mode:"payment"},"pre-hearing":{env:"PRICE_PRE_HEARING",mode:"payment"},"proof-of-service":{env:"PRICE_PROOF_OF_SERVICE",mode:"payment"},"trial-quick-ref":{env:["PRICE_TRIAL_QUICK_REF","PRICE_TRIAL_QUICK_REF_GUIDE"],mode:"payment"}}[s];if(!a)return t.status(400).json({error:"Invalid product slug"});let i=!!o.S5,{priceId:u,tried:c,presence:d}=function(e,{isTestKey:t}){let n=function(e,{isTestKey:t}){let n=Array.isArray(e)?e:[e],r=t?["_TEST","_LIVE",""]:["_LIVE","","_TEST"],o=[];for(let e of n)for(let t of r)o.push(t?`${e}${t}`:e);return[...new Set(o)]}(e,{isTestKey:t}),r=n.map(e=>({name:e,present:!!process.env[e]}));for(let e of n){let t=process.env[e];if(t&&/^price_/.test(t))return{priceId:t,tried:n,presence:r}}return{priceId:null,tried:n,presence:r}}(a.env,{isTestKey:i}),p=new Set(["support-nyop"]);if(e.query.debug)return t.status(200).json({slug:s,isTestKey:i,tried:c,present:d,chosen:u?{envName:d.find(e=>process.env[e.name]===u)?.name,priceId:u}:null,promosEnabled:!p.has(s)});if(!u)return t.status(500).json({error:"Price not configured",details:`Missing env for ${s}. Tried (in order): ${c.join(", ")}`});try{let e={mode:a.mode,line_items:[{price:u,quantity:1}],success_url:`${r}/thank-you?sku=${encodeURIComponent(s)}&session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${r}/?canceled=true`,metadata:{slug:s}};p.has(s)||(e.allow_promotion_codes=!0),"payment"===a.mode&&(e.customer_creation="if_required");let n=await o.GG.checkout.sessions.create(e);return t.status(200).json({url:n.url})}catch(n){if(console.error("Stripe session error:",{message:n?.message,type:n?.type,code:n?.code,param:n?.param}),e.query.debug)return t.status(500).json({error:"Unable to create checkout session.",message:n?.message,code:n?.code,type:n?.type});return t.status(500).json({error:"Unable to create checkout session."})}}o=(s.then?(await s)():s)[0],r()}catch(e){r(e)}})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=327);module.exports=n})();